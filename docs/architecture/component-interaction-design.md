# ç»„ä»¶äº¤äº’è®¾è®¡æ¶æ„æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å–µå’•è®°äº‹æœ¬å‰ç«¯ç»„ä»¶äº¤äº’è®¾è®¡æ¶æ„ï¼ŒåŒ…æ‹¬ç»„ä»¶å±‚æ¬¡ç»“æ„ã€Propsä¼ é€’æœºåˆ¶ã€äº‹ä»¶å¤„ç†ç³»ç»Ÿã€å›è°ƒå‡½æ•°è®¾è®¡ã€çŠ¶æ€å…±äº«æœºåˆ¶ã€ç»„ä»¶é€šä¿¡æ¨¡å¼ç­‰æ ¸å¿ƒè®¾è®¡ç†å¿µã€‚

---

## ğŸ—ï¸ ç»„ä»¶å±‚æ¬¡ç»“æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              App.jsx (æ ¹ç»„ä»¶)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   AppHeader     â”‚  â”‚   TabBar        â”‚  â”‚   CodeEditor    â”‚  â”‚   TreeViewerâ”‚ â”‚
â”‚  â”‚   (åº”ç”¨å¤´éƒ¨)     â”‚  â”‚   (æ ‡ç­¾é¡µ)      â”‚  â”‚   (ä»£ç ç¼–è¾‘å™¨)   â”‚  â”‚   (æ ‘å½¢è§†å›¾) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                     â”‚                     â”‚                     â”‚    â”‚
â”‚           â–¼                     â–¼                     â–¼                     â–¼    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SettingsModal  â”‚  â”‚   TabItem       â”‚  â”‚  MarkdownViewer â”‚  â”‚   TreeNode  â”‚ â”‚
â”‚  â”‚  (è®¾ç½®å¼¹çª—)      â”‚  â”‚   (æ ‡ç­¾é¡¹)      â”‚  â”‚  (Markdowné¢„è§ˆ) â”‚  â”‚   (æ ‘èŠ‚ç‚¹)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                       â”‚                          â”‚
â”‚                                                       â–¼                          â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                                            â”‚  WelcomeScreen  â”‚                  â”‚
â”‚                                            â”‚  (æ¬¢è¿ç•Œé¢)      â”‚                  â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶åˆ†å±‚è®¾è®¡

#### 1. å®¹å™¨å±‚ (Container Layer)

- **App.jsx**: æ ¹å®¹å™¨ç»„ä»¶ï¼Œè´Ÿè´£å…¨å±€çŠ¶æ€ç®¡ç†å’Œè·¯ç”±æ§åˆ¶
- **AppContent**: å†…å®¹å®¹å™¨ï¼Œå¤„ç†ç¼–è¾‘å™¨æ¨¡å¼åˆ‡æ¢å’Œä¸»é¢˜ç®¡ç†

#### 2. å¸ƒå±€å±‚ (Layout Layer)

- **AppHeader**: å¤´éƒ¨å¸ƒå±€ï¼ŒåŒ…å«èœå•æ å’Œçª—å£æ§åˆ¶
- **TabBar**: æ ‡ç­¾é¡µå¸ƒå±€ï¼Œç®¡ç†å¤šæ–‡ä»¶æ ‡ç­¾é¡µæ˜¾ç¤º

#### 3. åŠŸèƒ½å±‚ (Feature Layer)

- **CodeEditor**: ä»£ç ç¼–è¾‘åŠŸèƒ½ç»„ä»¶
- **MarkdownViewer**: Markdowné¢„è§ˆåŠŸèƒ½ç»„ä»¶
- **TreeViewer**: æ ‘å½¢è§†å›¾åŠŸèƒ½ç»„ä»¶
- **TreeEditor**: æ ‘å½¢ç¼–è¾‘åŠŸèƒ½ç»„ä»¶

#### 4. å·¥å…·å±‚ (Utility Layer)

- **SettingsModal**: è®¾ç½®å¼¹çª—å·¥å…·ç»„ä»¶
- **WelcomeScreen**: æ¬¢è¿ç•Œé¢å·¥å…·ç»„ä»¶

---

## ğŸ“¡ Propsä¼ é€’æœºåˆ¶

### 1. æ ¸å¿ƒPropsè®¾è®¡æ¨¡å¼

#### 1.1 é…ç½®å‹Props

```typescript
// ç»„ä»¶é…ç½®å±æ€§
interface ComponentConfig {
    isDarkMode: boolean;          // ä¸»é¢˜é…ç½®
    fontSize: number;             // å­—ä½“å¤§å°é…ç½®
    showLineNumbers: boolean;     // æ˜¾ç¤ºè¡Œå·é…ç½®
    readOnly: boolean;           // åªè¯»æ¨¡å¼é…ç½®
}

// ä½¿ç”¨ç¤ºä¾‹
<CodeEditor
    isDarkMode = {theme.isDarkMode}
fontSize = {editor.fontSize}
showLineNumbers = {editor.showLineNumbers}
readOnly = {currentFile?.readOnly || false
}
/>
```

#### 1.2 æ•°æ®å‹Props

```typescript
// æ•°æ®ä¼ é€’å±æ€§
interface DataProps {
    content: string;              // æ–‡ä»¶å†…å®¹
    language: string;             // ç¼–ç¨‹è¯­è¨€
    currentFile: FileInfo;        // å½“å‰æ–‡ä»¶ä¿¡æ¯
    openedFiles: FileInfo[];      // æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨
}

// ä½¿ç”¨ç¤ºä¾‹
<CodeEditor
    content = {currentFile?.content || ''
}
language = {getLanguageFromFileName(currentFile?.name
)
}
currentFile = {currentFile}
/>
```

#### 1.3 è¡Œä¸ºå‹Props

```typescript
// è¡Œä¸ºå›è°ƒå±æ€§
interface BehaviorProps {
    onChange: (content: string) => void;      // å†…å®¹å˜åŒ–å›è°ƒ
    onSave: () => void;                      // ä¿å­˜æ“ä½œå›è°ƒ
    onFileSelect: (file: FileInfo) => void;  // æ–‡ä»¶é€‰æ‹©å›è°ƒ
    onClose: (filePath: string) => void;     // å…³é—­æ–‡ä»¶å›è°ƒ
}

// ä½¿ç”¨ç¤ºä¾‹
<CodeEditor
    onChange = {handleContentChange}
onSave = {handleSaveFile}
/>
```

### 2. Propsä¼ é€’å±‚æ¬¡

#### 2.1 é¡¶å±‚Propsåˆ†å‘

```jsx
// App.jsx - æ ¹ç»„ä»¶Propsåˆ†å‘
const App = () => {
    const {theme, editor, fileManager} = useAppState();

    return (
        <div className="app">
            <AppHeader
                fileManager={fileManager}
                hasOpenFiles={fileManager.openedFiles.length > 0}
            />

            <TabBar
                fileManager={fileManager}
            />

            <CodeEditor
                isDarkMode={theme.isDarkMode}
                fileManager={fileManager}
                showMarkdownPreview={editor.showMarkdownPreview}
                isHeaderVisible={ui.isHeaderVisible}
                setCursorPosition={setCursorPosition}
                setCharacterCount={setCharacterCount}
            />
        </div>
    );
};
```

#### 2.2 ä¸­é—´å±‚Propsè½¬å‘

```jsx
// AppHeader.jsx - ä¸­é—´å±‚Propså¤„ç†
const AppHeader = ({fileManager, hasOpenFiles}) => {
    const {currentFile, openFile, saveFile, createFile} = fileManager;

    return (
        <Header className="app-header">
            <FileMenu
                currentFile={currentFile}
                onOpenFile={openFile}
                onSaveFile={saveFile}
                onCreateFile={createFile}
                hasOpenFiles={hasOpenFiles}
            />

            <WindowControls
                onMinimize={handleMinimize}
                onMaximize={handleMaximize}
                onClose={handleClose}
            />
        </Header>
    );
};
```

#### 2.3 å¶å­ç»„ä»¶Propsæ¶ˆè´¹

```jsx
// CodeEditor.jsx - å¶å­ç»„ä»¶Propsä½¿ç”¨
const CodeEditor = ({
                        isDarkMode,
                        fileManager,
                        showMarkdownPreview,
                        setCursorPosition,
                        setCharacterCount
                    }) => {
    const {currentFile, updateCode} = fileManager;

    const handleContentChange = useCallback((newContent) => {
        updateCode(newContent);
        setCharacterCount(newContent.length);
    }, [updateCode, setCharacterCount]);

    return (
        <div className={`code-editor ${isDarkMode ? 'dark' : 'light'}`}>
            {/* ç¼–è¾‘å™¨å®ç° */}
        </div>
    );
};
```

---

## ğŸ¯ äº‹ä»¶å¤„ç†ç³»ç»Ÿ

### 1. äº‹ä»¶å¤„ç†æ¶æ„

#### 1.1 äº‹ä»¶æµå‘å›¾

```
ç”¨æˆ·æ“ä½œ â†’ DOMäº‹ä»¶ â†’ ç»„ä»¶äº‹ä»¶å¤„ç†å™¨ â†’ ä¸šåŠ¡é€»è¾‘Hook â†’ Redux Action â†’ çŠ¶æ€æ›´æ–° â†’ ç»„ä»¶é‡æ¸²æŸ“
    â†“           â†“            â†“              â†“            â†“           â†“
  ç‚¹å‡»æŒ‰é’®    onClick     handleClick    useFileManager  openFile   currentFile
```

#### 1.2 äº‹ä»¶å¤„ç†å±‚æ¬¡

```jsx
// 1. DOMäº‹ä»¶æ•è·
<button onClick={handleOpenFile}>æ‰“å¼€æ–‡ä»¶</button>

// 2. ç»„ä»¶äº‹ä»¶å¤„ç†
const handleOpenFile = useCallback(async () => {
    try {
        // 3. è°ƒç”¨ä¸šåŠ¡é€»è¾‘Hook
        await fileOperations.openFile();
    } catch (error) {
        // 4. é”™è¯¯å¤„ç†
        message.error(`æ‰“å¼€æ–‡ä»¶å¤±è´¥: ${error.message}`);
    }
}, [fileOperations]);

// 5. ä¸šåŠ¡é€»è¾‘Hook
const useFileOperations = () => {
    const dispatch = useAppDispatch();

    const openFile = useCallback(async () => {
        // 6. è°ƒç”¨ç³»ç»ŸAPI
        const result = await invoke('open_file_dialog');

        if (result.success) {
            // 7. æ›´æ–°ReduxçŠ¶æ€
            dispatch(setCurrentFile(result.file));
        }
    }, [dispatch]);

    return {openFile};
};
```

### 2. äº‹ä»¶ç±»å‹åˆ†ç±»

#### 2.1 ç”¨æˆ·äº¤äº’äº‹ä»¶

```jsx
// ç‚¹å‡»äº‹ä»¶
const handleClick = useCallback((event) => {
    event.preventDefault();
    // å¤„ç†ç‚¹å‡»é€»è¾‘
}, []);

// é”®ç›˜äº‹ä»¶
const handleKeyDown = useCallback((event) => {
    if (event.ctrlKey && event.key === 's') {
        event.preventDefault();
        handleSave();
    }
}, [handleSave]);

// æ‹–æ‹½äº‹ä»¶
const handleDrop = useCallback((event) => {
    event.preventDefault();
    const files = Array.from(event.dataTransfer.files);
    files.forEach(file => openFile(file.path));
}, [openFile]);
```

#### 2.2 ç³»ç»Ÿäº‹ä»¶

```jsx
// æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶
useEffect(() => {
    const unlisten = listen('file-changed', (event) => {
        const {file_path, change_type} = event.payload;
        dispatch(updateFileStatus({path: file_path, status: change_type}));
    });

    return () => unlisten.then(fn => fn());
}, [dispatch]);

// çª—å£äº‹ä»¶
useEffect(() => {
    const handleResize = () => {
        // å¤„ç†çª—å£å¤§å°å˜åŒ–
        dispatch(updateWindowSize({
            width: window.innerWidth,
            height: window.innerHeight
        }));
    };

    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
}, [dispatch]);
```

#### 2.3 ç”Ÿå‘½å‘¨æœŸäº‹ä»¶

```jsx
// ç»„ä»¶æŒ‚è½½äº‹ä»¶
useEffect(() => {
    // ç»„ä»¶åˆå§‹åŒ–é€»è¾‘
    initializeComponent();

    return () => {
        // ç»„ä»¶æ¸…ç†é€»è¾‘
        cleanupComponent();
    };
}, []);

// ä¾èµ–å˜åŒ–äº‹ä»¶
useEffect(() => {
    if (currentFile) {
        // æ–‡ä»¶å˜åŒ–æ—¶çš„å¤„ç†é€»è¾‘
        loadFileContent(currentFile.path);
    }
}, [currentFile]);
```

---

## ğŸ”„ å›è°ƒå‡½æ•°è®¾è®¡

### 1. å›è°ƒå‡½æ•°æ¨¡å¼

#### 1.1 æ ‡å‡†å›è°ƒæ¨¡å¼

```typescript
// å›è°ƒå‡½æ•°ç±»å‹å®šä¹‰
type EventCallback<T = any> = (data: T) => void;
type AsyncEventCallback<T = any> = (data: T) => Promise<void>;

// ä½¿ç”¨ç¤ºä¾‹
interface CodeEditorProps {
    onChange: EventCallback<string>;           // å†…å®¹å˜åŒ–å›è°ƒ
    onSave: AsyncEventCallback<void>;         // ä¿å­˜æ“ä½œå›è°ƒ
    onCursorChange: EventCallback<Position>;   // å…‰æ ‡ä½ç½®å˜åŒ–å›è°ƒ
}

const CodeEditor: React.FC<CodeEditorProps> = ({
                                                   onChange,
                                                   onSave,
                                                   onCursorChange
                                               }) => {
    const handleContentChange = useCallback((newContent: string) => {
        onChange(newContent);
    }, [onChange]);

    const handleSaveAction = useCallback(async () => {
        try {
            await onSave();
            message.success('ä¿å­˜æˆåŠŸ');
        } catch (error) {
            message.error('ä¿å­˜å¤±è´¥');
        }
    }, [onSave]);

    return (
        // ç¼–è¾‘å™¨å®ç°
    );
};
```

#### 1.2 é«˜é˜¶å›è°ƒæ¨¡å¼

```jsx
// é«˜é˜¶å›è°ƒå‡½æ•°å·¥å‚
const createFileOperationCallback = (operation, dispatch) => {
    return useCallback(async (...args) => {
        dispatch(setLoading(true));

        try {
            const result = await operation(...args);
            dispatch(setOperationResult(result));
            return result;
        } catch (error) {
            dispatch(setError(error.message));
            throw error;
        } finally {
            dispatch(setLoading(false));
        }
    }, [operation, dispatch]);
};

// ä½¿ç”¨é«˜é˜¶å›è°ƒ
const useFileOperations = () => {
    const dispatch = useAppDispatch();

    const openFile = createFileOperationCallback(
        (filePath) => invoke('read_file_content', {path: filePath}),
        dispatch
    );

    const saveFile = createFileOperationCallback(
        (filePath, content) => invoke('write_file_content', {path: filePath, content}),
        dispatch
    );

    return {openFile, saveFile};
};
```

### 2. å›è°ƒå‡½æ•°ä¼˜åŒ–

#### 2.1 é˜²æŠ–å›è°ƒ

```jsx
// é˜²æŠ–å›è°ƒHook
const useDebouncedCallback = (callback, delay) => {
    const debouncedCallback = useMemo(
        () => debounce(callback, delay),
        [callback, delay]
    );

    useEffect(() => {
        return () => {
            debouncedCallback.cancel();
        };
    }, [debouncedCallback]);

    return debouncedCallback;
};

// ä½¿ç”¨é˜²æŠ–å›è°ƒ
const CodeEditor = ({onChange}) => {
    const debouncedOnChange = useDebouncedCallback(onChange, 300);

    const handleContentChange = useCallback((newContent) => {
        debouncedOnChange(newContent);
    }, [debouncedOnChange]);

    return (
        // ç¼–è¾‘å™¨å®ç°
    );
};
```

#### 2.2 èŠ‚æµå›è°ƒ

```jsx
// èŠ‚æµå›è°ƒHook
const useThrottledCallback = (callback, delay) => {
    const throttledCallback = useMemo(
        () => throttle(callback, delay),
        [callback, delay]
    );

    return throttledCallback;
};

// ä½¿ç”¨èŠ‚æµå›è°ƒ
const ScrollableComponent = ({onScroll}) => {
    const throttledOnScroll = useThrottledCallback(onScroll, 100);

    return (
        <div onScroll={throttledOnScroll}>
            {/* æ»šåŠ¨å†…å®¹ */}
        </div>
    );
};
```

---

## ğŸ”— çŠ¶æ€å…±äº«æœºåˆ¶

### 1. ReduxçŠ¶æ€å…±äº«

#### 1.1 å…¨å±€çŠ¶æ€ç»“æ„

```typescript
// å…¨å±€çŠ¶æ€ç±»å‹å®šä¹‰
interface RootState {
    theme: ThemeState;      // ä¸»é¢˜çŠ¶æ€
    editor: EditorState;    // ç¼–è¾‘å™¨çŠ¶æ€
    file: FileState;        // æ–‡ä»¶çŠ¶æ€
    ui: UIState;           // UIçŠ¶æ€
}

// çŠ¶æ€åˆ‡ç‰‡ç¤ºä¾‹
interface FileState {
    currentFile: FileInfo | null;     // å½“å‰æ–‡ä»¶
    openedFiles: FileInfo[];          // æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨
    recentFiles: FileInfo[];          // æœ€è¿‘æ–‡ä»¶åˆ—è¡¨
    isLoading: boolean;               // åŠ è½½çŠ¶æ€
    error: string | null;             // é”™è¯¯ä¿¡æ¯
}
```

#### 1.2 çŠ¶æ€é€‰æ‹©å™¨

```jsx
// åŸºç¡€é€‰æ‹©å™¨
const selectCurrentFile = (state) => state.file.currentFile;
const selectOpenedFiles = (state) => state.file.openedFiles;
const selectTheme = (state) => state.theme;

// å¤åˆé€‰æ‹©å™¨
const selectCurrentFileInfo = createSelector(
    [selectCurrentFile, selectTheme],
    (currentFile, theme) => ({
        file: currentFile,
        isDarkMode: theme.mode === 'dark',
        hasUnsavedChanges: currentFile?.modified || false
    })
);

// ç»„ä»¶ä¸­ä½¿ç”¨é€‰æ‹©å™¨
const FileEditor = () => {
    const fileInfo = useAppSelector(selectCurrentFileInfo);
    const dispatch = useAppDispatch();

    return (
        <div className={fileInfo.isDarkMode ? 'dark' : 'light'}>
            {fileInfo.hasUnsavedChanges && <UnsavedIndicator/>}
            {/* ç¼–è¾‘å™¨å†…å®¹ */}
        </div>
    );
};
```

### 2. ContextçŠ¶æ€å…±äº«

#### 2.1 Contextè®¾è®¡

```jsx
// æ–‡ä»¶ç®¡ç†Context
const FileManagerContext = createContext(null);

export const FileManagerProvider = ({children}) => {
    const [currentFile, setCurrentFile] = useState(null);
    const [openedFiles, setOpenedFiles] = useState([]);

    const fileManager = useMemo(() => ({
        currentFile,
        openedFiles,
        openFile: async (filePath) => {
            // æ‰“å¼€æ–‡ä»¶é€»è¾‘
        },
        closeFile: (filePath) => {
            // å…³é—­æ–‡ä»¶é€»è¾‘
        },
        saveFile: async (filePath, content) => {
            // ä¿å­˜æ–‡ä»¶é€»è¾‘
        }
    }), [currentFile, openedFiles]);

    return (
        <FileManagerContext.Provider value={fileManager}>
            {children}
        </FileManagerContext.Provider>
    );
};

// Context Hook
export const useFileManager = () => {
    const context = useContext(FileManagerContext);
    if (!context) {
        throw new Error('useFileManager must be used within FileManagerProvider');
    }
    return context;
};
```

#### 2.2 å¤šå±‚Contextç»„åˆ

```jsx
// åº”ç”¨çº§Contextç»„åˆ
const AppProviders = ({children}) => {
    return (
        <ThemeProvider>
            <FileManagerProvider>
                <EditorProvider>
                    <UIProvider>
                        {children}
                    </UIProvider>
                </EditorProvider>
            </FileManagerProvider>
        </ThemeProvider>
    );
};
```

### 3. è‡ªå®šä¹‰HookçŠ¶æ€å…±äº«

#### 3.1 çŠ¶æ€å…±äº«Hook

```jsx
// å…±äº«çŠ¶æ€Hook
const useSharedState = (initialValue) => {
    const [state, setState] = useState(initialValue);
    const stateRef = useRef(state);

    useEffect(() => {
        stateRef.current = state;
    }, [state]);

    const getState = useCallback(() => stateRef.current, []);

    return [state, setState, getState];
};

// å…¨å±€çŠ¶æ€ç®¡ç†
const globalState = {
    theme: null,
    editor: null,
    file: null
};

export const useGlobalState = (key) => {
    const [state, setState] = useState(globalState[key]);

    const updateState = useCallback((newState) => {
        globalState[key] = newState;
        setState(newState);

        // é€šçŸ¥å…¶ä»–ç»„ä»¶çŠ¶æ€å˜åŒ–
        window.dispatchEvent(new CustomEvent(`${key}-state-changed`, {
            detail: newState
        }));
    }, [key]);

    useEffect(() => {
        const handleStateChange = (event) => {
            setState(event.detail);
        };

        window.addEventListener(`${key}-state-changed`, handleStateChange);
        return () => window.removeEventListener(`${key}-state-changed`, handleStateChange);
    }, [key]);

    return [state, updateState];
};
```

---

## ğŸ“ ç»„ä»¶é€šä¿¡æ¨¡å¼

### 1. çˆ¶å­ç»„ä»¶é€šä¿¡

#### 1.1 Propså‘ä¸‹ä¼ é€’

```jsx
// çˆ¶ç»„ä»¶
const ParentComponent = () => {
    const [data, setData] = useState('åˆå§‹æ•°æ®');

    const handleDataChange = useCallback((newData) => {
        setData(newData);
    }, []);

    return (
        <ChildComponent
            data={data}
            onDataChange={handleDataChange}
        />
    );
};

// å­ç»„ä»¶
const ChildComponent = ({data, onDataChange}) => {
    const handleClick = () => {
        onDataChange('æ–°æ•°æ®');
    };

    return (
        <div>
            <p>æ•°æ®: {data}</p>
            <button onClick={handleClick}>æ›´æ–°æ•°æ®</button>
        </div>
    );
};
```

#### 1.2 Refå‘ä¸Šæš´éœ²

```jsx
// å­ç»„ä»¶ä½¿ç”¨forwardRef
const ChildComponent = forwardRef((props, ref) => {
    const [internalState, setInternalState] = useState('');

    useImperativeHandle(ref, () => ({
        getInternalState: () => internalState,
        setInternalState: (value) => setInternalState(value),
        focus: () => inputRef.current?.focus()
    }), [internalState]);

    return (
        <input
            ref={inputRef}
            value={internalState}
            onChange={(e) => setInternalState(e.target.value)}
        />
    );
});

// çˆ¶ç»„ä»¶ä½¿ç”¨ref
const ParentComponent = () => {
    const childRef = useRef();

    const handleGetChildState = () => {
        const state = childRef.current?.getInternalState();
        console.log('å­ç»„ä»¶çŠ¶æ€:', state);
    };

    return (
        <div>
            <ChildComponent ref={childRef}/>
            <button onClick={handleGetChildState}>è·å–å­ç»„ä»¶çŠ¶æ€</button>
        </div>
    );
};
```

### 2. å…„å¼Ÿç»„ä»¶é€šä¿¡

#### 2.1 é€šè¿‡å…±åŒçˆ¶ç»„ä»¶

```jsx
// å…±åŒçˆ¶ç»„ä»¶
const ParentComponent = () => {
    const [sharedData, setSharedData] = useState('');

    return (
        <div>
            <SiblingA
                data={sharedData}
                onDataChange={setSharedData}
            />
            <SiblingB
                data={sharedData}
                onDataChange={setSharedData}
            />
        </div>
    );
};

// å…„å¼Ÿç»„ä»¶A
const SiblingA = ({data, onDataChange}) => {
    return (
        <input
            value={data}
            onChange={(e) => onDataChange(e.target.value)}
            placeholder="åœ¨Aä¸­è¾“å…¥"
        />
    );
};

// å…„å¼Ÿç»„ä»¶B
const SiblingB = ({data}) => {
    return (
        <p>Bä¸­æ˜¾ç¤º: {data}</p>
    );
};
```

#### 2.2 é€šè¿‡äº‹ä»¶æ€»çº¿

```jsx
// äº‹ä»¶æ€»çº¿
class EventBus {
    constructor() {
        this.events = {};
    }

    on(event, callback) {
        if (!this.events[event]) {
            this.events[event] = [];
        }
        this.events[event].push(callback);
    }

    off(event, callback) {
        if (this.events[event]) {
            this.events[event] = this.events[event].filter(cb => cb !== callback);
        }
    }

    emit(event, data) {
        if (this.events[event]) {
            this.events[event].forEach(callback => callback(data));
        }
    }
}

export const eventBus = new EventBus();

// å‘é€æ–¹ç»„ä»¶
const SenderComponent = () => {
    const handleSendMessage = () => {
        eventBus.emit('message', 'æ¥è‡ªå‘é€æ–¹çš„æ¶ˆæ¯');
    };

    return (
        <button onClick={handleSendMessage}>å‘é€æ¶ˆæ¯</button>
    );
};

// æ¥æ”¶æ–¹ç»„ä»¶
const ReceiverComponent = () => {
    const [message, setMessage] = useState('');

    useEffect(() => {
        const handleMessage = (data) => {
            setMessage(data);
        };

        eventBus.on('message', handleMessage);

        return () => {
            eventBus.off('message', handleMessage);
        };
    }, []);

    return (
        <p>æ¥æ”¶åˆ°çš„æ¶ˆæ¯: {message}</p>
    );
};
```

### 3. è·¨å±‚çº§ç»„ä»¶é€šä¿¡

#### 3.1 Contextç©¿é€

```jsx
// æ·±å±‚Context
const DeepContext = createContext();

// é¡¶å±‚æä¾›è€…
const TopLevelProvider = ({children}) => {
    const [deepData, setDeepData] = useState('æ·±å±‚æ•°æ®');

    return (
        <DeepContext.Provider value={{deepData, setDeepData}}>
            {children}
        </DeepContext.Provider>
    );
};

// æ·±å±‚æ¶ˆè´¹è€…
const DeepComponent = () => {
    const {deepData, setDeepData} = useContext(DeepContext);

    return (
        <div>
            <p>æ·±å±‚æ•°æ®: {deepData}</p>
            <button onClick={() => setDeepData('æ›´æ–°çš„æ·±å±‚æ•°æ®')}>
                æ›´æ–°æ•°æ®
            </button>
        </div>
    );
};
```

#### 3.2 Portalé€šä¿¡

```jsx
// Portalç»„ä»¶
const PortalComponent = ({children, target}) => {
    return ReactDOM.createPortal(children, target);
};

// ä½¿ç”¨Portalè¿›è¡Œè·¨å±‚çº§æ¸²æŸ“
const App = () => {
    const [modalVisible, setModalVisible] = useState(false);

    return (
        <div>
            <button onClick={() => setModalVisible(true)}>
                æ‰“å¼€æ¨¡æ€æ¡†
            </button>

            {modalVisible && (
                <PortalComponent target={document.body}>
                    <Modal onClose={() => setModalVisible(false)}>
                        <p>è¿™æ˜¯ä¸€ä¸ªPortalæ¨¡æ€æ¡†</p>
                    </Modal>
                </PortalComponent>
            )}
        </div>
    );
};
```

---

## ğŸ¨ ç»„ä»¶è®¾è®¡æ¨¡å¼

### 1. é«˜é˜¶ç»„ä»¶æ¨¡å¼

#### 1.1 åŠŸèƒ½å¢å¼ºHOC

```jsx
// åŠ è½½çŠ¶æ€HOC
const withLoading = (WrappedComponent) => {
    return function WithLoadingComponent(props) {
        const [isLoading, setIsLoading] = useState(false);

        const enhancedProps = {
            ...props,
            isLoading,
            setLoading: setIsLoading
        };

        if (isLoading) {
            return <div className="loading">åŠ è½½ä¸­...</div>;
        }

        return <WrappedComponent {...enhancedProps} />;
    };
};

// ä½¿ç”¨HOC
const EnhancedComponent = withLoading(BaseComponent);
```

#### 1.2 æƒé™æ§åˆ¶HOC

```jsx
// æƒé™æ§åˆ¶HOC
const withPermission = (permission) => (WrappedComponent) => {
    return function WithPermissionComponent(props) {
        const {userPermissions} = useAuth();

        if (!userPermissions.includes(permission)) {
            return <div>æ— æƒé™è®¿é—®</div>;
        }

        return <WrappedComponent {...props} />;
    };
};

// ä½¿ç”¨æƒé™HOC
const ProtectedComponent = withPermission('admin')(AdminPanel);
```

### 2. æ¸²æŸ“å±æ€§æ¨¡å¼

#### 2.1 æ•°æ®è·å–ç»„ä»¶

```jsx
// æ•°æ®è·å–ç»„ä»¶
const DataFetcher = ({url, children}) => {
    const [data, setData] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        fetchData(url)
            .then(setData)
            .catch(setError)
            .finally(() => setLoading(false));
    }, [url]);

    return children({data, loading, error});
};

// ä½¿ç”¨æ¸²æŸ“å±æ€§
const App = () => {
    return (
        <DataFetcher url="/api/files">
            {({data, loading, error}) => {
                if (loading) return <div>åŠ è½½ä¸­...</div>;
                if (error) return <div>é”™è¯¯: {error.message}</div>;
                return <FileList files={data}/>;
            }}
        </DataFetcher>
    );
};
```

### 3. å¤åˆç»„ä»¶æ¨¡å¼

#### 3.1 å¤åˆç»„ä»¶è®¾è®¡

```jsx
// å¤åˆç»„ä»¶ä¸»ä½“
const FileExplorer = ({children}) => {
    const [selectedFile, setSelectedFile] = useState(null);
    const [expandedFolders, setExpandedFolders] = useState(new Set());

    const contextValue = {
        selectedFile,
        setSelectedFile,
        expandedFolders,
        setExpandedFolders
    };

    return (
        <FileExplorerContext.Provider value={contextValue}>
            <div className="file-explorer">
                {children}
            </div>
        </FileExplorerContext.Provider>
    );
};

// å¤åˆç»„ä»¶å­ç»„ä»¶
FileExplorer.Header = ({children}) => (
    <div className="file-explorer-header">{children}</div>
);

FileExplorer.Tree = ({files}) => {
    const {selectedFile, setSelectedFile} = useContext(FileExplorerContext);

    return (
        <div className="file-tree">
            {files.map(file => (
                <FileNode
                    key={file.path}
                    file={file}
                    selected={selectedFile === file}
                    onSelect={() => setSelectedFile(file)}
                />
            ))}
        </div>
    );
};

FileExplorer.Preview = () => {
    const {selectedFile} = useContext(FileExplorerContext);

    return (
        <div className="file-preview">
            {selectedFile ? (
                <FileContent file={selectedFile}/>
            ) : (
                <div>è¯·é€‰æ‹©æ–‡ä»¶</div>
            )}
        </div>
    );
};

// ä½¿ç”¨å¤åˆç»„ä»¶
const App = () => {
    return (
        <FileExplorer>
            <FileExplorer.Header>
                <h2>æ–‡ä»¶æµè§ˆå™¨</h2>
            </FileExplorer.Header>
            <FileExplorer.Tree files={files}/>
            <FileExplorer.Preview/>
        </FileExplorer>
    );
};
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç»„ä»¶æ¸²æŸ“ä¼˜åŒ–

#### 1.1 React.memoä¼˜åŒ–

```jsx
// ä½¿ç”¨React.memoé˜²æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“
const FileItem = React.memo(({file, onSelect, selected}) => {
    return (
        <div
            className={`file-item ${selected ? 'selected' : ''}`}
            onClick={() => onSelect(file)}
        >
            <span>{file.name}</span>
            <span>{file.size}</span>
        </div>
    );
}, (prevProps, nextProps) => {
    // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
    return (
        prevProps.file.path === nextProps.file.path &&
        prevProps.selected === nextProps.selected
    );
});
```

#### 1.2 useMemoå’ŒuseCallbackä¼˜åŒ–

```jsx
const FileList = ({files, searchTerm, sortBy}) => {
    // ç¼“å­˜è¿‡æ»¤å’Œæ’åºç»“æœ
    const filteredAndSortedFiles = useMemo(() => {
        return files
            .filter(file => file.name.includes(searchTerm))
            .sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'size':
                        return a.size - b.size;
                    case 'modified':
                        return new Date(b.modified) - new Date(a.modified);
                    default:
                        return 0;
                }
            });
    }, [files, searchTerm, sortBy]);

    // ç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°
    const handleFileSelect = useCallback((file) => {
        dispatch(setSelectedFile(file));
    }, [dispatch]);

    return (
        <div className="file-list">
            {filteredAndSortedFiles.map(file => (
                <FileItem
                    key={file.path}
                    file={file}
                    onSelect={handleFileSelect}
                />
            ))}
        </div>
    );
};
```

### 2. çŠ¶æ€æ›´æ–°ä¼˜åŒ–

#### 2.1 æ‰¹é‡çŠ¶æ€æ›´æ–°

```jsx
// æ‰¹é‡æ›´æ–°Hook
const useBatchedUpdates = () => {
    const [updates, setUpdates] = useState([]);
    const timeoutRef = useRef();

    const batchUpdate = useCallback((updateFn) => {
        setUpdates(prev => [...prev, updateFn]);

        if (timeoutRef.current) {
            clearTimeout(timeoutRef.current);
        }

        timeoutRef.current = setTimeout(() => {
            unstable_batchedUpdates(() => {
                updates.forEach(update => update());
                setUpdates([]);
            });
        }, 0);
    }, [updates]);

    return batchUpdate;
};
```

#### 2.2 é€‰æ‹©æ€§çŠ¶æ€è®¢é˜…

```jsx
// é€‰æ‹©æ€§çŠ¶æ€è®¢é˜…Hook
const useSelectiveState = (selector, equalityFn = Object.is) => {
    const state = useAppSelector(selector, equalityFn);
    return state;
};

// ä½¿ç”¨æµ…æ¯”è¾ƒ
const useShallowEqualSelector = (selector) => {
    return useAppSelector(selector, shallowEqual);
};

// ç»„ä»¶ä¸­ä½¿ç”¨
const FileEditor = () => {
    // åªè®¢é˜…éœ€è¦çš„çŠ¶æ€ç‰‡æ®µ
    const editorConfig = useSelectiveState(
        state => ({
            fontSize: state.editor.fontSize,
            theme: state.editor.theme,
            wordWrap: state.editor.wordWrap
        }),
        shallowEqual
    );

    return (
        <CodeEditor config={editorConfig}/>
    );
};
```

---

## ğŸ“‹ æœ€ä½³å®è·µæ€»ç»“

### 1. ç»„ä»¶è®¾è®¡åŸåˆ™

#### 1.1 å•ä¸€èŒè´£åŸåˆ™

- æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸ
- é¿å…ç»„ä»¶æ‰¿æ‹…è¿‡å¤šè´£ä»»
- ä¿æŒç»„ä»¶æ¥å£ç®€æ´æ˜ç¡®

#### 1.2 å¼€æ”¾å°é—­åŸåˆ™

- ç»„ä»¶å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
- é€šè¿‡Propså’Œæ’æ§½æ”¯æŒå®šåˆ¶åŒ–
- ä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿

#### 1.3 ä¾èµ–å€’ç½®åŸåˆ™

- ä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°
- é€šè¿‡ä¾èµ–æ³¨å…¥æé«˜å¯æµ‹è¯•æ€§
- ä½¿ç”¨æ¥å£å®šä¹‰ç»„ä»¶å¥‘çº¦

### 2. æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 2.1 æ¸²æŸ“ä¼˜åŒ–

- åˆç†ä½¿ç”¨React.memoã€useMemoã€useCallback
- é¿å…åœ¨æ¸²æŸ“å‡½æ•°ä¸­åˆ›å»ºæ–°å¯¹è±¡
- ä½¿ç”¨keyå±æ€§ä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“

#### 2.2 çŠ¶æ€ç®¡ç†ä¼˜åŒ–

- æœ€å°åŒ–çŠ¶æ€èŒƒå›´ï¼Œé¿å…è¿‡åº¦å…¨å±€åŒ–
- ä½¿ç”¨é€‰æ‹©å™¨æ¨¡å¼å‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“
- åˆç†æ‹†åˆ†çŠ¶æ€åˆ‡ç‰‡

#### 2.3 äº‹ä»¶å¤„ç†ä¼˜åŒ–

- ä½¿ç”¨äº‹ä»¶å§”æ‰˜å‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡
- åˆç†ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµ
- åŠæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨

### 3. ä»£ç è´¨é‡ä¿è¯

#### 3.1 ç±»å‹å®‰å…¨

- ä½¿ç”¨TypeScriptæä¾›ç±»å‹æ£€æŸ¥
- å®šä¹‰æ¸…æ™°çš„Propsæ¥å£
- ä½¿ç”¨æ³›å‹æé«˜ä»£ç å¤ç”¨æ€§

#### 3.2 é”™è¯¯å¤„ç†

- ä½¿ç”¨é”™è¯¯è¾¹ç•Œæ•è·ç»„ä»¶é”™è¯¯
- æä¾›å‹å¥½çš„é”™è¯¯æç¤º
- å®ç°ä¼˜é›…çš„é™çº§ç­–ç•¥

#### 3.3 æµ‹è¯•è¦†ç›–

- ç¼–å†™å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘
- ä½¿ç”¨é›†æˆæµ‹è¯•éªŒè¯ç»„ä»¶äº¤äº’
- å®ç°ç«¯åˆ°ç«¯æµ‹è¯•ä¿è¯ç”¨æˆ·ä½“éªŒ

---

## ğŸ“š æ€»ç»“

### æ¶æ„ä¼˜åŠ¿

1. **æ¸…æ™°çš„å±‚æ¬¡ç»“æ„**: ç»„ä»¶æŒ‰åŠŸèƒ½å’ŒèŒè´£åˆ†å±‚ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
2. **çµæ´»çš„é€šä¿¡æœºåˆ¶**: æ”¯æŒå¤šç§ç»„ä»¶é€šä¿¡æ¨¡å¼ï¼Œé€‚åº”ä¸åŒåœºæ™¯éœ€æ±‚
3. **é«˜æ•ˆçš„çŠ¶æ€ç®¡ç†**: ç»“åˆReduxå’ŒContextï¼Œå®ç°é«˜æ•ˆçš„çŠ¶æ€å…±äº«
4. **ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°**: é€šè¿‡å¤šç§ä¼˜åŒ–ç­–ç•¥ï¼Œç¡®ä¿åº”ç”¨æµç•…è¿è¡Œ
5. **å¼ºç±»å‹æ”¯æŒ**: TypeScriptæä¾›å®Œæ•´çš„ç±»å‹å®‰å…¨ä¿éšœ

### æŠ€æœ¯ç‰¹è‰²

1. **ç»„ä»¶åŒ–è®¾è®¡**: é«˜åº¦æ¨¡å—åŒ–çš„ç»„ä»¶æ¶æ„ï¼Œæ”¯æŒç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
2. **äº‹ä»¶é©±åŠ¨**: åŸºäºäº‹ä»¶çš„äº¤äº’æ¨¡å¼ï¼Œå®ç°æ¾è€¦åˆçš„ç»„ä»¶å…³ç³»
3. **çŠ¶æ€é›†ä¸­ç®¡ç†**: Reduxç»Ÿä¸€ç®¡ç†åº”ç”¨çŠ¶æ€ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
4. **æ€§èƒ½ä¼˜åŒ–**: å¤šå±‚æ¬¡çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒ
5. **å¯æ‰©å±•æ€§**: çµæ´»çš„æ¶æ„è®¾è®¡ï¼Œæ”¯æŒåŠŸèƒ½æ‰©å±•å’Œå®šåˆ¶

### ç»´æŠ¤æ€§ä¿éšœ

1. **ä»£ç è§„èŒƒ**: ç»Ÿä¸€çš„ä»£ç é£æ ¼å’Œå‘½åè§„èŒƒ
2. **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
3. **æµ‹è¯•è¦†ç›–**: å®Œæ•´çš„æµ‹è¯•ä½“ç³»ä¿è¯ä»£ç è´¨é‡
4. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
5. **ç›‘æ§ä½“ç³»**: æ€§èƒ½ç›‘æ§å’Œé”™è¯¯è¿½è¸ªç³»ç»Ÿ

---

*æœ¬æ–‡æ¡£åŸºäº miaogu-notepad v1.3.1 ç‰ˆæœ¬ç¼–å†™ï¼Œæ¶µç›–äº†å®Œæ•´çš„ç»„ä»¶äº¤äº’è®¾è®¡æ¶æ„*
